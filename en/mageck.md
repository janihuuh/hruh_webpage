Added April 17 2023 by Olli

# CRISPR screen analysis using MAGeCK

# 1. Generate sgRNA read count matrix from fastq files using MAGeCK count command

Resulting count.txt file can be used for mageck test command to find enriched/depleted genes

Example data: K562 cells cultured with or without NK cells

Bash script (for running in FIMM cluster): 

```bash
# add mageck directories to path
export PATH=$PATH:/fs/vault/pipelines/t_receptor/bin/mageck-0.5.7/fimm/bin
export PYTHONPATH=/fs/vault/pipelines/t_receptor/bin/mageck-0.5.7/fimm/lib/python2.7/site-packages/:$PYTHONPATH

# run mageck count command using GeCKO v2 library
# -l 			path to sgRNA library (no need to change if using GeCKOv2)
# -n 			analysis name
# --sample-label 	labels for all fastq files separated by commas (no spaces)
# --fastq 		complete paths to read1 (R1) fastq.gz files separated by spaces (data found in /fas/NGS/pipes/fastq/fimm_ngs_mustjoki/GeCKO_v2_CRISPR_screens/)
# --pdf-report 		produce pdf report of read mapping and counting

/apps/python275/bin/python /fs/vault/pipelines/t_receptor/bin/mageck-0.5.7/fimm/bin/mageck count -l /csc/mustjoki/crispr_screen/mageck/libraries/Human_GeCKOv2_Library_combine.csv -n example --sample-label ctrl,NK --fastq /fas/NGS/pipes/fastq/fimm_ngs_mustjoki/GeCKO_v2_CRISPR_screens/NK2378_CART_drugs_NALM6_K562/NK2378_K562/K562_GeCKO_v2_020519_d17_S20_L006_R1_001.fastq.gz /fas/NGS/pipes/fastq/fimm_ngs_mustjoki/GeCKO_v2_CRISPR_screens/NK2378_CART_drugs_NALM6_K562/NK2378_K562/NK2378_1_2_K562_GeCKO_v2_250419_d10_S16_L005_R1_001.fastq.gz --pdf-report 
```

# 2. Test enriched/depletion of genes using MAGeCK test command

Example data: K562 cells cultured with or without NK cells

Bash script (for running in FIMM cluster): 

```bash
# add mageck directories to path
export PATH=$PATH:/fs/vault/pipelines/t_receptor/bin/mageck-0.5.7/fimm/bin
export PYTHONPATH=/fs/vault/pipelines/t_receptor/bin/mageck-0.5.7/fimm/lib/python2.7/site-packages/:$PYTHONPATH

# run mageck test command using count.txt file generated by mageck count
# -k		count matrix
# -t		label of test condition in count.txt matrix
# -c		label of control condition in count.txt matrix
# -n 		analysis name
# --pdf-report	pdf report of analysis

/apps/python275/bin/python /fs/vault/pipelines/t_receptor/bin/mageck-0.5.7/fimm/bin/mageck test -k example.count.txt -t NK  -c ctrl -n example --pdf-report
```
